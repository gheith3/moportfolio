services:
    app:
        image: gheith3/moportfolio:latest
        restart: unless-stopped
        expose:
            - "9000"
        environment:
            APP_NAME: Mohammed Alramadani
            APP_ENV: production
            APP_LOCALE: en
            APP_DEBUG: false
            APP_KEY: ${APP_KEY}
            APP_URL: ${APP_URL}
            ASSET_URL: ${APP_URL}
            APP_FORCE_HTTPS: true
            DB_CONNECTION: sqlite
            DB_DATABASE: /var/www/html/database/database.sqlite
            REDIS_HOST: redis
            REDIS_PASSWORD: ${REDIS_PASSWORD}
            REDIS_PORT: 6379
            CACHE_DRIVER: redis
            SESSION_DRIVER: redis
            QUEUE_CONNECTION: sync
            LOG_CHANNEL: stack
            LOG_LEVEL: error
            FILESYSTEM_DISK: local
        volumes:
            - /apps/moportfolio/storage:/usr/share/nginx/html/storage:rw
            - /apps/moportfolio/database:/var/www/html/database:rw
        depends_on:
            - redis
        networks:
            - moportfolio-website-network

    nginx:
        image: nginx:alpine
        restart: unless-stopped
        user: "0:0"
        ports:
            - "7085:80"
        volumes:
            - /apps/moportfolio/storage:/usr/share/nginx/html/storage:ro
            - /apps/moportfolio/nginx.conf:/etc/nginx/conf.d/default.conf:ro
        depends_on:
            - app
        networks:
            - moportfolio-website-network
        labels:
            - "npm.enable=true"
            - "npm.host=moportfolio.mkanee.om"
            - "npm.port=7085"

    redis:
        image: bitnami/redis:7.2
        restart: unless-stopped
        expose:
            - "6379"
        environment:
            - ALLOW_EMPTY_PASSWORD=no
            - REDIS_PASSWORD=${REDIS_PASSWORD}
            - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL
        networks:
            - moportfolio-website-network

networks:
    moportfolio-website-network:
        driver: bridge
